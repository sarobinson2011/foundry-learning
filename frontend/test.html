<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Manager Interface</title>
    <!-- Include web3.js library -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
</head>

<body>
    <h1>Token Manager Interface</h1>

    <label for="toAddress">To Address:</label>
    <input type="text" id="toAddress" placeholder="Recipient's address">

    <label for="amount">Amount:</label>
    <input type="text" id="amount" placeholder="Amount">


    <!-- Buttons HERE -->
    <button onclick="connectWallet()">Connect Your Wallet</button>
    <button onclick="transferReward()">Transfer Reward</button>


    <!-- Script starts HERE -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>

    <script>

        import Web3 from 'web3';

        const web3 = new Web3("https://testnet.aurora.dev");

        // Replace with your TokenManager contract address
        const contractAddress = '0xb136843F392dd2f174063ee469a875F642444146';
        const contractABI = [
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "rewardTokenAddress",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_rewardTokenAddress",
                        "type": "address"
                    }
                ],
                "name": "setRewardTokenAddress",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_to",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "_amount",
                        "type": "uint256"
                    }
                ],
                "name": "transferReward",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ]

        const contract = new web3.eth.Contract(contractABI, contractAddress);

        // Connect to a web3 provider - Metamask
        async function connectWallet() {
            if (window.ethereum) {
                try {
                    await window.ethereum.enable();
                    web3 = new Web3(window.ethereum);
                    console.log("Connected to wallet:", web3.currentProvider.selectedAddress);
                } catch (error) {
                    console.error("Error connecting to wallet:", error);
                }
            } else {
                console.error("No wallet detected");
            }
        }

        // make the call to transferReward()
        async function transferReward() {
            const toAddress = document.getElementById('toAddress').value;
            const amount = document.getElementById('amount').value;

            try {
                const accounts = await web3.eth.requestAccounts();
                const account = accounts[0];

                const result = await contract.methods.transferReward(toAddress, amount).send({ from: account });
                console.log(result);
                alert('Transaction successful!');
            } catch (error) {
                console.error(error);
                alert('Transaction failed. Please check the console for details.');
            }
        }
    </script>

</body>

</html>